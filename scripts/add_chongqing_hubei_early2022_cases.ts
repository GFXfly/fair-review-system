
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    // Group 1: Chongqing Cases (2022-03-30)
    const cqReportTitle = '重庆市市场监督管理局纠正3起滥用行政权力排除、限制竞争行为';
    const cqReportDate = '2022-03-30';
    const cqDepartment = '重庆市市场监督管理局'; // Although header says SAMR, title says CQ AMR corrected... usually these are published by provincial AMRs or reposted. The image says "通告机构：国家市场监督管理总局", but title is "重庆市...". Let's use SAMR as department if the image explicitly says so, OR structure it as a SAMR notification about CQ. 
    // Image header: "通告机构：国家市场监督管理总局". So Department should be SAMR.
    // However, to differentiate, I might name the report "国家市场监督管理总局关于重庆市市场监督管理局纠正3起滥用行政权力排除、限制竞争行为的通报"?
    // The image text is just the case title. Let's use a descriptive title for the report encompassing the batch.

    // Actually, looking at the images, they are all individual "通告".
    // I will group them into one report for CQ and one for HB to keep it clean, as they were likely uploaded together.

    // Report 1: Chongqing
    let cqReport = await prisma.report.findFirst({
        where: { title: cqReportTitle }
    });

    if (!cqReport) {
        cqReport = await prisma.report.create({
            data: {
                title: cqReportTitle,
                department: '国家市场监督管理总局',
                publishDate: cqReportDate,
                province: '重庆市'
            }
        });
        console.log(`Created Report: ${cqReportTitle}`);
    }

    const cqCases = [
        {
            title: '重庆市市场监督管理局纠正两江新区国有资产监督管理局滥用行政权力排除、限制竞争行为',
            province: '重庆市两江新区',
            documentOrg: '两江新区国有资产监督管理局',
            violationType: '指定交易/限定银行',
            documentName: '《关于加强两江新区直属企业资金和银行账户管理的通知》（渝两江国资发〔2020〕65号）',
            violationClause: '《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '规定区属国有企业在开设一般账户时，应当选择税收和经济指标在两江新区辖区内的银行（附银行名单），需报审批；原有不符合规定的账户需变更或销户；贷款账户新设必须在辖区内银行开设。',
            content: `2021年10月，重庆市市场监管局对两江新区国有资产监督管理局涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2020年6月23日，两江新区国有资产监督管理局下发了《关于加强两江新区直属企业资金和银行账户管理的通知》（渝两江国资发〔2020〕65号），文件规定：一是区属国有企业（包括直属企业及其全资、控股子公司，下同）在开设一般账户时，应当选择税收和经济指标在两江新区辖区内的银行（该文件后附银行名单），开户流程需报两江新区国有资产监督管理局审核；二是区属国有企业原有银行账户不符合该文件规定的，需在规定时间内变更至指定范围的银行，或者做销户处理；三是区属国有企业在区外开设的贷款账户，可以通过提前还款后销户，企业新设贷款必须在两江新区内银行开设账户。
两江新区国有资产监督管理局上述行为违反《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”之规定，排除、限制了竞争。
当事人认识到上述行为违反了《反垄断法》规定，在调查期间积极整改，消除了不良影响。一是废止了相关文件，2022年1月15日，当事人在两江新区官网发布通知，将原文件予以废止。二是举一反三，对规范性文件进行清理和审查。三是加强干部职工对公平竞争审查相关制度的学习培训，进一步增强公平竞争审查意识。
依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定：“在调查期间，当事人主动采取措施停止相关行为，消除相关后果的，反垄断执法机构可以结束调查。”考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`,
            result: `依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`
        },
        {
            title: '重庆市市场监督管理局纠正涪陵区农业农村委员会滥用行政权力排除、限制竞争行为',
            province: '重庆市涪陵区',
            documentOrg: '涪陵区农业农村委员会',
            violationType: '指定交易/限定银行',
            documentName: '《关于印发<重庆市涪陵区2021-2023年农机购置补贴实施方案>的通知》（涪农委发〔2021〕65号）',
            violationClause: '《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '规定“补贴资金申请-申请材料-邮政储蓄银行银行卡（折）”，要求购机者必须持有邮政储蓄银行银行卡（折），才能申请农机购置补贴。',
            content: `2021年11月，重庆市市场监管局对涪陵区农业农村委员会涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2021年9月16日，涪陵区农业农村委员会、涪陵区财政局联合印发了《关于印发<重庆市涪陵区2021-2023年农机购置补贴实施方案>的通知》（涪农委发〔2021〕65号），文件规定：“补贴资金申请-申请材料-邮政储蓄银行银行卡（折）”，要求购机者必须持有邮政储蓄银行银行卡（折），才能申请农机购置补贴。
涪陵区农业农村委员会在发放农机购置补贴时，要求购机者持有其指定的银行卡（折）的行为违反《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”之规定，排除、限制了竞争。
当事人认识到上述行为违反了《反垄断法》规定，在调查期间积极整改，消除了不良影响。一是废止了相关文件，2022年1月20日，当事人在其官网发布《关于重庆市涪陵区2021—2023年农机购置补贴工作的补充通知》（涪农委发〔2021〕76号），将申请农机补贴时提交“邮政储蓄银行卡（折）”更正为“购机者本人名下有效期内的任意一张银行卡（折）”。二是组织干部职工认真学习《反垄断法》《公平竞争审查制度实施细则》，全面清理废除妨碍统一市场和公平竞争的各种规定做法，严格落实公平竞争审查制度。
依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`,
            result: `依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`
        },
        {
            title: '重庆市市场监督管理局纠正合川区教育委员会滥用行政权力排除、限制竞争行为',
            province: '重庆市合川区',
            documentOrg: '合川区教育委员会',
            violationType: '指定交易/独家经营',
            documentName: '《重庆市合川区教育委员会关于坚持民生导向服务教育事业加强中小学后勤服务管理工作的意见》（合川教〔2011〕230号）',
            violationClause: '《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '规定全区中小学教辅资料发行、校服采购、办公用品文教用品体育器材供给、学生保险代理、教育考察培训，均由学子公司统一组织或代理。',
            content: `2021年11月，重庆市市场监管局对合川区教育委员会涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2011年5月23日，合川区教委下发了《重庆市合川区教育委员会关于坚持民生导向服务教育事业加强中小学后勤服务管理工作的意见》（合川教〔2011〕230号），文件规定“一是全区中小学教辅资料发行统一由合川区教委组织，具体由学子公司统一发行；二是全区中小学校服采购统一由学子公司组织供货；三是全区中小学办公用品、文教用品、体育器材供给，一律由学子公司集中采购供给；四是全区中小学学生保险，统一由学子公司代理；五是全区教育考察培训，统一由学子公司组织办理”。
合川区教育委员会上述行为违反《反垄断法》第三十二条“行政机关不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”之规定，排除、限制了竞争。
当事人认识到上述行为违反了《反垄断法》规定，在调查期间积极整改，消除了不良影响。一是废止了相关文件，2021年12月9日，当事人在其官网发布《关于废止合川教〔2011〕230号文件的决定》（合川教〔2021〕461号），将原文件予以废止。二是认真学习《反垄断法》《公平竞争审查制度实施细则》，严格落实公平竞争审查制度，举一反三对规范性文件进行清理和审查。
依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`,
            result: `依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，重庆市市场监管局按程序结束调查。`
        }
    ];

    for (const c of cqCases) {
        const existing = await prisma.case.findFirst({ where: { title: c.title } });
        if (!existing) {
            await prisma.case.create({
                data: { ...c, reportId: cqReport.id, publishDate: cqReportDate }
            });
            console.log(`Added CQ case: ${c.title}`);
        } else {
            console.log(`Skipping existing CQ case: ${c.title}`);
        }
    }

    // Group 2: Hubei Cases (2022-02-25)
    const hbReportTitle = '湖北省市场监督管理局纠正2起滥用行政权力排除、限制竞争行为';
    const hbReportDate = '2022-02-25';

    let hbReport = await prisma.report.findFirst({
        where: { title: hbReportTitle }
    });

    if (!hbReport) {
        hbReport = await prisma.report.create({
            data: {
                title: hbReportTitle,
                department: '国家市场监督管理总局',
                publishDate: hbReportDate,
                province: '湖北省'
            }
        });
        console.log(`Created Report: ${hbReportTitle}`);
    }

    const hbCases = [
        {
            title: '湖北省市场监管局纠正黄冈市城市管理执法委员会滥用行政权力排除、限制竞争行为',
            province: '湖北省黄冈市',
            documentOrg: '黄冈市城市管理执法委员会',
            violationType: '准入障碍/地域限制',
            documentName: '《2021年度项目招标代理机构遴选公告》',
            violationClause: '《反垄断法》第三十四条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，以设定歧视性资质要求、评审标准或者不依法发布信息等方式，排斥或者限制外地经营者参加本地招标投标活动。”',
            violationDetail: '要求招标代理机构在黄冈市区具有固定的经营场所（提供自有房产证或租用房产协议或其他房产证明材料）。',
            content: `2021年11月，湖北省市场监管局对黄冈市城市管理执法委员会涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2021年3月，黄冈市城市管理执法委员会决定对项目招标代理机构进行遴选，在政府网上发布《2021年度项目招标代理机构遴选公告》，要求招标代理机构在黄冈市区具有固定的经营场所（提供自有房产证或租用房产协议或其他房产证明材料）。
当事人明确要求招标代理机构在黄冈市区具有固定的经营场所的行为违反了《反垄断法》第三十四条规定：“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，以设定歧视性资质要求、评审标准或者不依法发布信息等方式，排斥或者限制外地经营者参加本地招标投标活动。”构成滥用行政权力排除、限制竞争行为。
当事人认识到上述行为违反了《反垄断法》规定，在调查期间积极整改，消除了不良影响。一是废止相关文件。2021年12月22日，在政府网上公示《关于废止<2021年度项目招标代理机构遴选入围结果公示>的公告》。二是召开会议检视整改。2021年12月2日，召开党委扩大会学习公平竞争相关法律文件，要求全面清理废除妨碍统一市场和公平竞争的各种规定做法...三是全面清理现行政策措施...
依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，湖北省市场监管局按程序结束调查。`,
            result: `依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，湖北省市场监管局按程序结束调查。`
        },
        {
            title: '湖北省市场监管局纠正随州市自然资源和规划局滥用行政权力排除、限制竞争行为',
            province: '湖北省随州市',
            documentOrg: '随州市自然资源和规划局',
            violationType: '准入障碍/强制备案',
            documentName: '《关于开展2021年土地估价机构备案工作的通知》',
            violationClause: '《反垄断法》第三十七条规定：“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定。”',
            violationDetail: '明确要求“在我市行政辖区内从事评估业务的土地估价机构，应事先向我局申请备案，凭备案证明开展土地估价业务。申请备案的土地估价机构，须已经省自然资源厅同意予以备案。”',
            content: `2021年11月，湖北省市场监管局对随州市自然资源和规划局涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2021年4月，随州市自然资源和规划局为加强土地估价行业监管，规范土地估价机构和从业人员行为，决定开展2021年土地估价机构备案工作，在政府网上发布《关于开展2021年土地估价机构备案工作的通知》，明确要求“在我市行政辖区内从事评估业务的土地估价机构，应事先向我局申请备案，凭备案证明开展土地估价业务。申请备案的土地估价机构，须已经省自然资源厅同意予以备案。”上述行为违反了《反垄断法》第三十七条规定：“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定。”构成滥用行政权力排除、限制竞争行为。
当事人认识到上述行为违反了《反垄断法》规定，在调查期间积极整改，消除了不良影响。一是废止了相关文件。2021年11月25日，将《关于开展2021年土地估价机构备案工作的通知》等公示内容从政府网站上撤回；12月2日，印发《关于对开展土地评估机构备案妨碍公平竞争问题整改的通知》，要求各地对土地评估机构备案作出的有关规定进行清理废除...二是召开专题整改会议...
依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，湖北省市场监管局按程序结束调查。`,
            result: `依据《制止滥用行政权力排除、限制竞争行为暂行规定》第十九条规定...考虑到当事人已主动采取措施停止相关行为，消除相关后果，湖北省市场监管局按程序结束调查。`
        }
    ];

    for (const c of hbCases) {
        const existing = await prisma.case.findFirst({ where: { title: c.title } });
        if (!existing) {
            await prisma.case.create({
                data: { ...c, reportId: hbReport.id, publishDate: hbReportDate }
            });
            console.log(`Added HB case: ${c.title}`);
        } else {
            console.log(`Skipping existing HB case: ${c.title}`);
        }
    }

}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

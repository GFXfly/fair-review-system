import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加扬州市5起公平竞争审查典型案例...');

    // 1. 创建通报
    const reportData = {
        title: '扬州发布5起公平竞争审查典型案例',
        department: '扬州市市场监督管理局',
        publishDate: '2025-03-03',
        province: '江苏省'
    };

    let report = await prisma.report.findFirst({
        where: { title: reportData.title }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报, ID:', report.id);
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加5个案例
    const cases = [
        {
            title: '某县（市、区）政府要求投资项目中优先采购本地产品案',
            content: `【文件名称】《某县（市、区）“十四五”战略性新兴产业发展规划》
【违规内容】含有“强化示范应用，按照‘当购当用’原则，在全区政府投资项目中优先采购符合标准的本地产品”等内容。
【审查解析】违反了《公平竞争审查条例》第八条“起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：（三）限定经营、购买或者使用特定经营者提供的商品或者服务”之规定。
【处理结果】目前，该文件已修订。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《某县（市、区）“十四五”战略性新兴产业发展规划》',
            documentOrg: '某县（市、区）政府',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务（以下统称商品）。`,
            violationDetail: '在全区政府投资项目中优先采购符合标准的本地产品，限定购买特定经营者提供的商品。',
        },
        {
            title: '某县（市、区）政府给予特定经营者优惠政策案',
            content: `【文件名称】《某县（市、区）关于深化供销合作社综合改革的实施意见》
【违规内容】含有“扶持某商务有限公司发展成为本地为农服务的供销电商平台，每年在基层社和农资网点建设铺设电商服务站3个以上”等内容。
【审查解析】违反了《公平竞争审查条例》第十条“起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：（二）给予特定经营者减免获取、行政事业性收费、政府性基金、社会保险费等方面的优惠”之规定。
【处理结果】目前，该文件已废止。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《某县（市、区）关于深化供销合作社综合改革的实施意见》',
            documentOrg: '某县（市、区）政府',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（三）给予特定经营者减免获取、行政事业性收费、政府性基金、社会保险费等方面的优惠。`,
            violationDetail: '扶持特定公司发展，给予特定经营者优惠政策。',
        },
        {
            title: '某县（市、区）政府设定市场退出障碍，限制企业迁出案',
            content: `【文件名称】《某县（市、区）关于加快资本市场建设的实施办法》
【违规内容】含有“企业在上市过程中注册地变更为外地的或企业上市、挂牌后5年之内注册地变更为外地的，之前所享受的土地出让金优惠、政府补贴、专项扶持资金等各项优惠政策全额退回”等内容。
【审查解析】违反了《公平竞争审查条例》第九条“起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：（一）限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出”之规定。
【处理结果】目前，该文件已废止。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《某县（市、区）关于加快资本市场建设的实施办法》',
            documentOrg: '某县（市、区）政府',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（一）限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出。`,
            violationDetail: '规定企业迁出需全额退回此前享受的优惠政策，阻碍本地经营者迁出。',
        },
        {
            title: '某镇政府在招投标中强制投标企业在本地成立分支机构案',
            content: `【文件名称】《关于某镇环境监测水质自动监测站建设项目公开招标公告》
【违规内容】中的“在项目所在地成立服务机构或分公司并设置合适的办公场地”等内容。
【审查解析】违反了《公平竞争审查条例》第九条“起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构”之规定。
【处理结果】目前，该文件已废止。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《关于某镇环境监测水质自动监测站建设项目公开招标公告》',
            documentOrg: '某镇政府',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构。`,
            violationDetail: '要求在项目所在地成立服务机构或分公司，强制外地经营者设立分支机构。',
        },
        {
            title: '某部门对外地经营者设置歧视性补贴政策案',
            content: `【文件名称】《关于组织申报2024年度某专项资金项目的通知》
【违规内容】中的“（一）项目申报单位条件 1、在扬州市境内注册登记、具有独立法人资格”等内容。
【审查解析】违反了《公平竞争审查条例》第九条“起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：（四）对外地或者进口商品、要素设置歧视性收费项目、收费标准、价格或者补贴”之规定。
【处理结果】目前，该文件已废止。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《关于组织申报2024年度某专项资金项目的通知》',
            documentOrg: '某部门',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（四）对外地或者进口商品、要素设置歧视性收费项目、收费标准、价格或者补贴。`,
            violationDetail: '限定申报单位需在扬州市境内注册登记，对外地经营者设置歧视性条件。',
        },
    ];

    let count = 0;
    for (const caseData of cases) {
        await prisma.case.create({
            data: {
                ...caseData,
                province: '江苏省',
                publishDate: reportData.publishDate,
                legalScope: '公平竞争审查',
                reportId: report.id
            }
        });
        console.log(`✅ 已添加案例 ${count + 1}:`, caseData.title);
        count++;
    }

    console.log(`\n处理完成，共添加 ${count} 个案例到 Report ID ${report.id}。`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

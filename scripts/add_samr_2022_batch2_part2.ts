
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    const reportTitle = '2022年制止滥用行政权力排除、限制竞争执法专项行动案件（第二批）';

    // Find the existing report
    const report = await prisma.report.findFirst({
        where: { title: reportTitle }
    });

    if (!report) {
        console.error(`Report not found: ${reportTitle}. Please run the first batch script first.`);
        return;
    }

    const cases = [
        {
            title: '黑龙江省市场监管局纠正七台河市住房和城乡建设局滥用行政权力排除、限制竞争行为',
            province: '黑龙江省七台河市',
            documentOrg: '七台河市住房和城乡建设局',
            violationType: '指定交易/独家经营',
            documentName: '《城市燃气特许经营协议》',
            violationClause: '《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '将该市特许经营权地域范围内所有管道燃气工程安装权（包括市政规划红线内管道燃气工程）分别授予两家燃气公司。',
            content: `2021年10月28日，黑龙江省市场监管局依法对七台河市住房和城乡建设局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2014年3月和2018年1月，当事人分别与两家燃气公司签订了《城市燃气特许经营协议》，将该市特许经营权地域范围内所有管道燃气工程安装权（包括市政规划红线内管道燃气工程）分别授予两家燃气公司。
黑龙江省市场监管局认为，特许经营协议限定了建设开发单位只能与上述两家燃气公司签订协议，由燃气公司对管道燃气入户安装工程进行设计、安装，剥夺了建设开发单位自主选择燃气工程安装企业参与施工的权利，以及其他具有燃气工程安装资质企业的公平竞争权，排除和限制了相关市场的竞争，违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人积极整改，消除不良影响。一是分别与两家燃气公司签订了《城市管道燃气特许经营协议相关条款调整协议》，修改原协议有关条款，调整后的特许经营权及特许经营范围不再包含建筑区划红线内燃气管道工程安装。二是制发《关于规范燃气工程安装市场行为的通知》，明确凡具备燃气安装工程资质的企业均可参与七台河市燃气工程安装的施工，促进燃气工程安装市场的公平竞争，并在七台河市人民政府官网公布。三是向黑龙江省市场监管局报送整改报告，表示将严格执行公平竞争审查制度，凡涉及市场主体经济活动的政策措施必须经过公平竞争审查，防止出现排除、限制竞争的情况。`
        },
        {
            title: '广西壮族自治区市场监管局纠正灵川县交通运输局滥用行政权力排除、限制竞争行为',
            province: '广西壮族自治区桂林市灵川县',
            documentOrg: '灵川县交通运输局',
            violationType: '指定交易/强制设备与服务',
            documentName: '《灵川县重点营运车辆安装使用智能视频监控装置的通知》、《灵川县运输管理所关于明确货运车辆二级维护服务厂家的通知》',
            violationClause: '《中华人民共和国反垄断法》第三十二条',
            violationDetail: '要求其管辖范围内的客货营运车辆统一使用桂林某科技有限公司的智能视频监控装置，要求货运车辆到其指定的2家维修企业开展二级维护工作。',
            content: `2021年9月1日，广西壮族自治区市场监管局对灵川县交通运输局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2019年11月25日，当事人指示灵川县运输管理所发布《灵川县重点营运车辆安装使用智能视频监控装置的通知》和《灵川县运输管理所关于明确货运车辆二级维护服务厂家的通知》，要求其管辖范围内的客货营运车辆统一使用桂林某科技有限公司的智能视频监控装置，否则将对未按要求使用智能视频监控的运输企业采取暂停运力发展、审验不予通过等措施，同时，还要求货运运输企业按照车辆二级维护要求到其指定的2家维修企业开展货运车辆二级维护工作。
广西壮族自治区市场监管局认为，当事人作为行政机关，先后通过发布通知的方式，要求其辖区内客货运营车辆使用指定公司的智能视频监控装置，并要求货运运输企业到其指定的2家维修企业进行车辆二级维护，限制了辖区内运输企业对车辆动态监控装置和车辆维修企业的自由选择权，排除、限制了当地车辆动态信息监控和车辆维护服务市场竞争，损害了县内运输企业及交易相对人的利益。当事人的上述行为违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人积极整改，消除了不良影响。一是立即成立整改领导小组，提出整改措施，落实整改任务。二是及时废止通知，纠正不当行为。2021年8月26日和27日，当事人分别发布撤销相关文件的通知，消除对灵川县客货营运车辆动态信息监控服务市场、车辆二级维护服务市场的影响。三是加强与运输企业沟通；全面梳理核查，清退不合理收费。四是认真组织学习法律法规，完善公平竞争审查机制，构建公平竞争营商环境。`
        },
        {
            title: '湖南省市场监管局纠正永州市零陵区教育局等部门滥用行政权力排除、限制竞争行为',
            province: '湖南省永州市零陵区',
            documentOrg: '永州市零陵区教育局、零陵区卫生健康局',
            violationType: '指定交易/指定服务',
            documentName: '《关于全面开启全区中小学校学生视力建档的通知》（2021年1月15日）',
            violationClause: '《中华人民共和国反垄断法》第三十二条',
            violationDetail: '明确要求全县各中小学校、职业中专学生到零陵某医院进行视力检查。',
            content: `2021年7月，湖南省市场监管局对永州市零陵区教育局等部门涉嫌滥用行政权力排除、限制竞争行为进行了调查。
经查，2021年1月15日，当事人联合零陵区卫生健康局下发《关于全面开启全区中小学校学生视力建档的通知》，规定“明确要求全县各中小学校、职业中专学生到零陵某医院进行视力检查”。
湖南省市场监管局认为，当事人的上述行为违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，排除、限制了其他医疗、体检机构（经营者）参与视力检查建档的机会，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人积极整改，主动纠正违法行为，联合有关部门发文废止了上述文件，消除了不良社会影响，恢复了市场公平竞争。`
        },
        {
            title: '湖南省市场监管局纠正祁阳市教育局等部门滥用行政权力排除、限制竞争行为',
            province: '湖南省永州市祁阳市',
            documentOrg: '祁阳市教育局、祁阳市卫生健康局',
            violationType: '指定交易/指定服务',
            documentName: '《印发<关于全面开启祁阳县中小学校学生建立视力健康发育档案活动方案>的通知》（2021年3月8日）',
            violationClause: '《中华人民共和国反垄断法》第三十二条',
            violationDetail: '直接指定某眼科医院为本次视力检查建档机构。',
            content: `2021年7月，湖南省市场监管局对祁阳市教育局等部门涉嫌滥用行政权力排除、限制竞争行为进行了调查。
经查，2021年3月8日，当事人联合祁阳市卫生健康局下发《印发<关于全面开启祁阳县中小学校学生建立视力健康发育档案活动方案>的通知》，直接指定某眼科医院为本次视力检查建档机构。
湖南省市场监管局认为，当事人上述行为违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，排除了其他医疗、体检机构（经营者）参与视力检查建档的机会，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人高度重视，积极整改，主动纠正违法行为，联合有关部门发文宣布停止执行上述文件，消除了不良社会影响，恢复了市场公平竞争。`
        },
        {
            title: '湖南省市场监管局纠正平江县文化旅游广电体育局滥用行政权力排除、限制竞争行为',
            province: '湖南省岳阳市平江县',
            documentOrg: '平江县文化旅游广电体育局',
            violationType: '歧视性待遇/特定品牌优惠',
            documentName: '2021年7月26日印发的规定优惠政策的文件',
            violationClause: '《中华人民共和国反垄断法》第三十二条',
            violationDetail: '规定“穿戴某品牌衣服、裤子、鞋子、袜子、帽子、护腕、头带的，吃某品牌方便面或喝某品牌果汁的，均享受优惠”。',
            content: `2021年7月，湖南省市场监管局对平江县文化旅游广电体育局涉嫌滥用行政权力排除、限制竞争行为进行调查。
经查，2021年7月26日，当事人印发文件，规定“穿戴某品牌衣服、裤子、鞋子、袜子、帽子、护腕、头带的，吃某品牌方便面或喝某品牌果汁的，均享受优惠”。
湖南省市场监管局认为，当事人的上述行为违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人积极整改，撤销了上述文件，并对所有公众号、抖音号等平台的此类宣传信息全部予以下架，消除了不良社会影响。`
        }
    ];

    for (const item of cases) {
        const exists = await prisma.case.findFirst({
            where: {
                title: item.title,
                reportId: report.id
            }
        });

        if (!exists) {
            await prisma.case.create({
                data: {
                    ...item,
                    reportId: report.id,
                    publishDate: '2022-07-29'
                }
            });
            console.log(`Added case: ${item.title}`);
        } else {
            console.log(`Updating existing case: ${item.title}`);
            await prisma.case.update({
                where: { id: exists.id },
                data: {
                    content: item.content,
                    result: item.result,
                    province: item.province,
                    documentOrg: item.documentOrg,
                    documentName: item.documentName,
                    violationType: item.violationType,
                    violationClause: item.violationClause,
                    violationDetail: item.violationDetail,
                    publishDate: '2022-07-29'
                }
            });
        }
    }
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

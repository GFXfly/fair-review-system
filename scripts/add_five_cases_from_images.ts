
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    const departmentStr = '国家市场监督管理总局';

    // 1. 安徽当涂案例
    const case1Data = {
        title: '安徽省市场监管局纠正马鞍山市当涂县人民政府滥用行政权力排除、限制竞争行为',
        publishDate: '2023-07-14',
        province: '安徽省',
        department: departmentStr,
        content: `2022年9月28日，安徽省市场监管局依法对当涂县人民政府涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2019年7月19日，当涂县人民政府办公室印发《当涂县二次供水管理暂行办法（试行）的通知》（当政办〔2019〕20号），要求当涂县新建开发小区涉及到二次供水的，在项目实施前，开发企业应当与项目所在区域取得特许经营权供水单位签订二次供水管理协议，协议应明确双方对二次供水设施建设、维护和运行管理的权利和义务；在建的二次供水设施由建设单位委托取得特许经营权供水单位进行施工。
安徽省市场监管局认为，当事人的上述行为排除、限制了该县新建小区二次供水设施工程建设市场的竞争，违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人主动采取措施停止相关行为，消除相关竞争限制。印发《关于同意废止〈当涂县二次供水管理暂行办法（试行）〉的批复》，要求相关部门立即停止执行。重新草拟《当涂县二次供水管理暂行办法》（征求意见稿），公开征求意见，组织座谈交流，经过合法性审查和公平竞争审查后，以县政府办公室名义重新印发。`,
        violationType: '指定交易/滥用行政权力',
        violationClause: '《中华人民共和国反垄断法》第三十九条（不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品）',
        documentName: '《当涂县二次供水管理暂行办法（试行）的通知》（当政办〔2019〕20号）',
        documentOrg: '安徽省马鞍山市当涂县人民政府',
        provinceDetail: '安徽省马鞍山市当涂县',
        violationDetail: '要求在建的二次供水设施由建设单位委托取得特许经营权供水单位进行施工，指定了施工单位。',
        result: '废止原文件，重新草拟并公开征求意见。'
    };

    // 2. 四川宜宾珙县案例
    const case2Data = {
        title: '四川省市场监管局纠正宜宾市珙县住房城乡建设和城镇管理局滥用行政权力排除、限制竞争行为',
        publishDate: '2023-06-27',
        province: '四川省',
        department: departmentStr,
        content: `2022年7月1日，四川省市场监管局依法对珙县住房城乡建设和城镇管理局涉嫌滥用行政权力排除、限制竞争行为进行立案调查。
经查，为推进该县非居民用户燃气报警器安装工作，2022年3月22日至23日，当事人牵头组织该县应急管理局、市场监督管理局、经济商务信息化和科学技术局、各乡镇人民政府对某三家燃气公司在该县范围非居民用户燃气泄露报警装置安装召开攻坚专题会，会议决定在全县范围内推广使用集中燃气报警控制系统，由上述三家公司实施，要求安装价格不高于2760元/台，不得再收取其他费用。
四川省市场监管局认为，当事人在没有技术规范依据的情况下，在该县非居民用户燃气报警装置安装推进工作中要求全县统一选用集中式燃气报警装置控制系统，由前述三家公司实施的行为，剥夺了非居民用户选择燃气报警控制系统的自主权，排除、限制了燃气报警控制系统经营者之间的竞争。该行为违反了修改前的《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人积极整改，立即停止执行非居民燃气用户统一安装集中式报警装置等要求，全面开展入户调查，本着用户自愿的原则全面开展集中排查更换、退还差价，全面完成整改及退费等相关工作，及时消除了不良影响，保障了非居民用户的自主选择权，恢复该县燃气报警装置市场的竞争秩序，并加强相关法律法规学习，加强行业指导，严格依法行使职权。`,
        violationType: '指定交易/滥用行政权力',
        violationClause: '《中华人民共和国反垄断法》第三十二条（修订前）（不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品）',
        documentName: '专题会议决定',
        documentOrg: '四川省宜宾市珙县住房城乡建设和城镇管理局',
        provinceDetail: '四川省宜宾市珙县',
        violationDetail: '要求全县统一选用集中式燃气报警装置控制系统，并指定三家公司实施。',
        result: '停止统一安装要求，开展入户调查，退还差价。'
    };

    // 3. 江西定南案例
    const case3Data = {
        title: '江西省市场监管局纠正定南县城市管理局滥用行政权力排除、限制竞争行为',
        publishDate: '2023-06-20',
        province: '江西省',
        department: departmentStr,
        content: `2023年4月7日，江西省市场监管局依法对定南县城市管理局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2022年12月9日，当事人委托某招标代理有限公司通过中国招标与采购网发布定南县主城区共享电动单车经营权项目公开招标公告。2022年12月22日，当事人确定了2家共享电动单车运营企业为定南县主城区共享电动单车经营权项目企业。2022年12月27日和2023年1月15日，当事人分别与上述2家共享电动单车运营企业签订了《定南县中心城区共享电动自行车运营管理合同》，限定投放数量1500辆，运营期限3年。
江西省市场监管局认为，当事人在没有法律、法规依据的情况下，通过公开招标的方式确定2家共享电动单车运营企业为定南县主城区共享电动单车经营企业，排除、限制了其他具有合格资质和服务能力的经营主体进入该县主城区经营共享电动单车服务市场，妨碍了该市场的公平竞争，违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人积极整改，向江西省市场监管局提交了整改报告，废止有关合同，通过官方网站发布公告，全面放开该县主城区共享电动单车市场，表示将进一步落实公平竞争审查制度，健全公平竞争审查机制，有效防止排除、限制竞争行为。`,
        violationType: '指定交易/限制准入',
        violationClause: '《中华人民共和国反垄断法》第三十九条（不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品）',
        documentName: '《定南县中心城区共享电动自行车运营管理合同》',
        documentOrg: '江西省赣州市定南县城市管理局',
        provinceDetail: '江西省赣州市定南县',
        violationDetail: '通过招标确定2家运营企业，限制其他合格主体进入市场。',
        result: '废止合同，全面放开市场，发布公告。'
    };

    // 4. 新疆乌鲁木齐案例
    const case4Data = {
        title: '新疆维吾尔自治区市场监管局纠正乌鲁木齐市建设局滥用行政权力排除、限制竞争行为',
        publishDate: '2023-06-20',
        province: '新疆维吾尔自治区',
        department: departmentStr,
        content: `2022年4月，新疆维吾尔自治区市场监管局依法对乌鲁木齐市建设局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，当事人印发《关于进一步加强建筑施工现场外墙保温材料质量安全管理工作的通知》（乌建防发〔2019〕429号）、《关于公布第二批外墙保温材料生产质量承诺企业名录的通知》（乌建防发〔2020〕87号）、《关于公布第二批外墙保温材料生产质量承诺企业名录的补充通知》（乌建防发〔2020〕105号）等文件，要求乌鲁木齐市建设单位购买、使用名录内经营者提供的外墙保温材料和外墙保温材料检验检测单位提供的服务。为取得实际效果，当事人又通过开展专项检查的方式并印发《关于我市建筑施工现场保温材料专项检查情况的通报》，要求乌鲁木齐市建设单位禁止购买、使用名录外经营者提供的外墙保温材料和外墙保温材料检验检测单位提供的服务。
新疆维吾尔自治区市场监管局认为，当事人在没有法律、法规和国家政策依据情况下，设置并执行不合理的企业名录，变相限定建设单位购买、使用名录内经营者提供的外墙保温材料和外墙保温材料检验检测单位提供的服务，使得名录外企业无法进入相关市场，排除、限制了市场公平竞争，当事人的上述行为违反了修改前的《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”和第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人主动采取措施进行整改，废止了相关政策措施，并在乌鲁木齐市建设局监管服务平台网站予以公示。`,
        violationType: '指定交易/设置不合理名录',
        violationClause: '《中华人民共和国反垄断法》第三十二条（修订前，指定交易）、第三十七条（制定含有排除限制竞争规定）',
        documentName: '《关于进一步加强建筑施工现场外墙保温材料质量安全管理工作的通知》等',
        documentOrg: '新疆维吾尔自治区乌鲁木齐市建设局',
        provinceDetail: '新疆维吾尔自治区乌鲁木齐市',
        violationDetail: '设置“红名单”限制建设单位只能购买使用名录内企业的材料和服务。',
        result: '废止相关政策措施，并公示。'
    };

    // 5. 内蒙古巴彦淖尔案例
    const case5Data = {
        title: '内蒙古发布一起公平竞争审查典型案例 涉及一地共享单车行业',
        publishDate: '2023-05-10',
        province: '内蒙古自治区',
        department: '内蒙古市场监督管理局',
        content: `为大政策措施制定机关维护全国统一大市场和公平竞争的意识，按照《内蒙古自治区公平竞争审查典型案例公示制度》要求，现内蒙古自治区公平竞争审查工作厅际联席会议办公室发布1起违反公平竞争审查典型案例，供各地各部门政策制定机关分析学习，防止出台妨碍统一市场建设和公平竞争的各种规定和做法，全面深入落实公平竞争审查制度。

案例：巴彦淖尔市临河区交通运输局发布竞争性磋商公告，通过竞争性磋商的方式设定共享单车特许经营权，妨碍了其他经营者进入共享单车市场。

【基本案情】
巴彦淖尔市临河区交通运输局委托某项目管理有限公司发布《巴彦淖尔市临河区共享单车特许经营项目》竞争性磋商公告，拟通过竞争性磋商的方式确定一家中标企业负责临河区共享单车和共享电动车的投放以及管理。

【定性分析】
上述措施违反了《公平竞争审查制度实施细则》十三条第二项第一点关于未经公平竞争不得授予经营者特许经营权，包括但不限于在一般竞争性领域实施特许经营或者以特许经营名为名增设行政许可的标准。
自治区公平竞争审查工作厅际联席会议办公室认为，政府特许经营应面向提供公共产品的公用事业。将共享单车纳入特许经营于法无据，损害了市场竞争和消费者权益。

【纠正情况】
自治区公平竞争审查工作厅际联席会议办公室收到群众实名举报后，对相关情况进行了核实，确认违反公平竞争审查标准后，由巴彦淖尔市公平竞争审查联席会议办公室下发公平竞争审查建议函，并已指导纠正。

【专家点评】
《市政公用事业特许经营管理办法》就提出了特许经营的概念... 但需要指出的是，这种（将共享单车纳入特许经营）认识是错误的，并且和特许经营的目的背道而驰...
就共享单车而言，本属于充分竞争行业... 因此在这种情况下对共享单车行业实施特许经营是画蛇添足... 更是严重阻碍了统一市场的构建。`,
        violationType: '违规特许经营/一般竞争领域设限',
        violationClause: '《公平竞争审查制度实施细则》第十三条第二项第一点（未经公平竞争不得授予经营者特许经营权）',
        documentName: '《巴彦淖尔市临河区共享单车特许经营项目》竞争性磋商公告',
        documentOrg: '内蒙古自治区巴彦淖尔市临河区交通运输局',
        provinceDetail: '内蒙古自治区巴彦淖尔市临河区',
        violationDetail: '拟通过竞争性磋商确定一家企业负责共享单车投放，违规实施特许经营。',
        result: '下发审查建议函，指导纠正。'
    };

    const cases = [case1Data, case2Data, case3Data, case4Data, case5Data];

    for (const c of cases) {
        // Find or create report
        let report = await prisma.report.findFirst({
            where: { title: c.title }
        });

        if (!report) {
            report = await prisma.report.create({
                data: {
                    title: c.title,
                    department: c.department,
                    publishDate: c.publishDate,
                    province: c.province,
                }
            });
            console.log(`Created Report: ${report.title}`);
        } else {
            console.log(`Report exists: ${report.title}`);
        }

        // Check if case exists
        const existingCase = await prisma.case.findFirst({
            where: {
                title: c.title,
                reportId: report.id
            }
        });

        if (!existingCase) {
            await prisma.case.create({
                data: {
                    title: c.title,
                    content: c.content,
                    violationType: c.violationType,
                    violationClause: c.violationClause,
                    documentName: c.documentName,
                    documentOrg: c.documentOrg,
                    province: c.provinceDetail,
                    violationDetail: c.violationDetail,
                    result: c.result,
                    publishDate: c.publishDate,
                    reportId: report.id
                }
            });
            console.log(`Created Case: ${c.title}`);
        } else {
            console.log(`Case exists: ${c.title}`);
        }
    }
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

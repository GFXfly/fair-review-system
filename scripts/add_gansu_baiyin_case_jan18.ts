
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    // 1. 查找刚才创建的甘肃省局通报 (Report ID 43)
    // 通报日期：2024-01-18
    // 部门：甘肃省市场监管局
    // 注意：我们要把这个新案例（白银市保健委案）也挂到 Report ID 43 下面

    // 先确认 Report ID 43 存在（模拟，实际直接操作数据库）
    // 为了保险起见，我们重新查找一下那个 Report
    const report = await prisma.report.findFirst({
        where: {
            department: '甘肃省市场监管局',
            publishDate: '2024-01-18',
            province: '甘肃省'
        }
    });

    if (!report) {
        console.error('未找到指定的通报记录 (2024-01-18 甘肃省局通报)');
        return;
    }

    console.log(`找到通报记录，ID: ${report.id}`);

    // 2. 添加/更新 Report 的标题，使其更具包容性
    // 原标题可能只提到了“靖远县”，现在加上“白银市”
    await prisma.report.update({
        where: { id: report.id },
        data: {
            title: '甘肃省市场监管局纠正白银市部分单位滥用行政权力排除、限制竞争行为典型案例通报'
        }
    });

    // 3. 添加新的案例：白银市保健委案（原文录入）
    const newCase = await prisma.case.create({
        data: {
            title: '甘肃省白银市保健委员会、白银市财政局、白银市卫生健康委员会滥用行政权力排除、限制竞争行为（2024-01-18通报版）',
            content: `2023年9月28日，甘肃省市场监管局依法对白银市保健委员会、白银市财政局、白银市卫生健康委员会（以下简称当事人）涉嫌滥用行政权力排除、限制竞争行为为立案调查。
    经查，2022年4月6日，当事人印发《关于做好市直机关事业单位干部职工健康体检工作的通知》，规定：“按照属地化原则，确定市第一人民医院、市中西医结合医院、市妇幼保健院、市康复医院为市直机关事业单位干部职工健康体检定点医疗机构。市直各部门、单位组织的健康体检必须在定点医疗机构进行，不得在非定点医疗机构安排。市直机关事业单位在非定点医疗机构安排干部职工健康体检的经费，市级财政一律不予支付”。
    甘肃省市场监管局认为，健康体检市场是一个竞争的市场，体检单位可以自主选择具有合格资质和服务能力的健康体检机构，具有合格资质和服务能力的健康体检机构均可以提供体检服务。而当事人无相关法律法规依据，按照属地化原则，确定市直机关事业单位干部职工健康体检定点医疗机构，要求市直各部门、单位组织的健康体检必须在定点医疗机构进行，不得在非定点医疗机构安排，直接剥夺了体检单位的自主选择权，排除了其他具有合格资质和服务能力的健康体检机构提供服务，妨碍了健康体检市场的公平竞争，违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。
    调查期间，当事人充分认识到其相关行为违反了《中华人民共和国反垄断法》有关规定，主动改正违法行为，及时废止了相关文件并在政府网站公告，向甘肃省市场监管局提交了整改报告，举一反三完善工作机制，积极消除相关后果，恢复健康体检市场的竞争秩序。`,
            violationType: '限定交易/排斥竞争',
            violationClause: '《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            documentName: '《关于做好市直机关事业单位干部职工健康体检工作的通知》',
            documentOrg: '甘肃省白银市保健委员会、白银市财政局、白银市卫生健康委员会',
            province: '甘肃省',
            violationDetail: '按照属地化原则，确定市直机关事业单位干部职工健康体检定点医疗机构，要求必须在定点机构进行，非定点机构经费不予支付。',
            result: '主动改正违法行为，及时废止相关文件并在政府网站公告，向甘肃省市场监管局提交整改报告。',
            publishDate: '2024-01-18', // 保持一致
            reportId: report.id
        }
    });

    console.log(`✓ 已添加案例: ${newCase.title}`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加辽宁省6起公平竞争审查典型案例...');

    // 1. 创建通报
    const reportData = {
        title: '辽宁省市场监督管理局发布6起公平竞争审查典型案例',
        department: '辽宁省市场监督管理局',
        publishDate: '2024-11-22',
        province: '辽宁省'
    };

    let report = await prisma.report.findFirst({
        where: { title: reportData.title }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报, ID:', report.id);
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加6个案例
    const cases = [
        {
            title: '某县交通运输局招标代理机构入库公告限制外地企业案',
            content: `【文件名称】《某县交通运输局及其所属事业单位招标代理机构选定入库公告》
【违规内容】规定：本地交通运输行业政府投资项目招标代理机构选定入库单位，原则上在辽宁省内注册，若注册地为外地，则必须在所属市、县有办事处或分支机构。
【审查解析】该政策措施通过限制招标代理机构注册地为本地、在本地设立分支机构，排斥外地招标代理机构在本地提供服务。违反了《公平竞争审查条例》相关规定。
【处理结果】相关部门已整改完毕。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《某县交通运输局及其所属事业单位招标代理机构选定入库公告》',
            documentOrg: '某县交通运输局',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务。

《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构。`,
            violationDetail: '原则上要求在辽宁省内注册，若注册地为外地，则必须在所属市、县有办事处或分支机构，排斥外地招标代理机构。',
        },
        {
            title: '某开发区管委会《工业企业帮扶方案》排斥外地产品案',
            content: `【文件名称】《工业企业帮扶方案》
【违规内容】规定：鼓励域内企业协作配套与产品对标，在同等质量、价格条件下，鼓励企业、政府优先采购。
【审查解析】赋予了本地企业进入本地市场的特权，排斥了全国统一大市场的建设。违反了《公平竞争审查条例》禁止限定交易和排斥外地产品的规定。
【处理结果】相关部门已整改完毕。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《工业企业帮扶方案》',
            documentOrg: '某开发区管委会',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务。

《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（三）排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标。`,
            violationDetail: '鼓励域内企业协作配套与产品对标，鼓励企业、政府优先采购本地产品，排斥外地产品。',
        },
        {
            title: '某市政府《关于进一步推进工业企业上形规上市企业发展的实施意见》限定交易案',
            content: `【文件名称】《关于进一步推进工业企业上形规上市企业发展的实施意见》
【违规内容】规定：优先推荐上市企业产品进入该市规模以上企业产品名录，同时优先采购名录上的产品。
【审查解析】既限制了本地上市企业公平参与市场竞争，又阻碍了外地企业进入本地市场竞争。
【处理结果】相关部门已整改完毕。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于进一步推进工业企业上形规上市企业发展的实施意见》',
            documentOrg: '某市政府及办公室',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务。

《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（三）排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标。`,
            violationDetail: '优先推荐上市企业产品进入名录并优先采购，限定交易，阻碍外地企业进入本地市场。',
        },
        {
            title: '某市政府办公室《关于促进民营经济发展条例实施意见的通知》实施差异化奖励案',
            content: `【文件名称】《关于促进民营经济发展条例实施意见的通知》
【违规内容】规定：对境外上市或买壳、借壳等方式在境内证券交易市场上市并将上市公司注册地迁至该市，纳入具备1亿元人民币以上的企业给予资金扶持。
【审查解析】该项政策措施在没有法律、行政法规依据或者国务院批准的前提下，对境外上市企业注册地迁入给予资金奖励。
【处理结果】相关部门已整改完毕。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《关于促进民营经济发展条例实施意见的通知》',
            documentOrg: '某市政府办公室',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '对上市公司注册地迁至该市给予资金扶持，实施差异化财政奖励。',
        },
        {
            title: '某县人民政府办公室《关于进一步推进挖潜增效干部的实施方案》实施差异化奖励案',
            content: `【文件名称】《关于进一步推进挖潜增效干部的实施方案》
【违规内容】规定：对于认定后每年新增纳税额达到1000万元以上的规上工业企业（不含采矿业、房地产企业），给予企业一次性20万元的扶持资金。
【审查解析】该项政策措施在没有法律、行政法规依据或者国务院批准的前提下，将每年新增纳税额达到1000万元以上规上工业企业给予资金奖励。
【处理结果】相关部门已整改完毕。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《关于进一步推进挖潜增效干部的实施方案》',
            documentOrg: '某县人民政府办公室',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '对新增纳税额达到一定标准的规上工业企业给予一次性扶持资金，实施差异化财政奖励。',
        },
        {
            title: '某市工业和信息化局《关于支持软件和信息技术服务业发展若干政策措施》实施差异化奖励案',
            content: `【文件名称】《关于支持软件和信息技术服务业发展暨发展若干政策措施》
【违规内容】规定：对最新引进的国内外重点软件或硬件企业，且落户之日起两年内年度营业收入超过2000万元的，按实缴注册资本...分别给予一次性200万元、300万元、500万元奖励。
【审查解析】该项政策措施违反公平竞争审查制度关于“没有法律、行政法规依据或者国务院批准，不得含有...给予特定经营者选择性、差异化的财政奖励或者补贴”的审查标准。
【处理结果】相关部门已整改完毕。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《关于支持软件和信息技术服务业发展暨发展若干政策措施》',
            documentOrg: '某市工业和信息化局',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '对引进的落户企业按注册资本给予一次性大额奖励，实施差异化财政奖励。',
        },
    ];

    let count = 0;
    for (const caseData of cases) {
        await prisma.case.create({
            data: {
                ...caseData,
                province: '辽宁省',
                publishDate: reportData.publishDate,
                legalScope: '公平竞争审查',
                reportId: report.id
            }
        });
        console.log(`✅ 已添加案例 ${count + 1}:`, caseData.title);
        count++;
    }

    console.log(`\n处理完成，共添加 ${count} 个案例到 Report ID ${report.id}。`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });


import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    const reportTitle = '2022年制止滥用行政权力排除、限制竞争执法专项行动案件（第二批）';
    const publishDate = '2022-07-29';
    const department = '国家市场监督管理总局';

    // 1. Create or Find Report
    let report = await prisma.report.findFirst({
        where: { title: reportTitle }
    });

    if (!report) {
        console.log(`Creating report: ${reportTitle}`);
        report = await prisma.report.create({
            data: {
                title: reportTitle,
                department: department,
                publishDate: publishDate,
                province: '全国'
            }
        });
    } else {
        console.log(`Report already exists: ${reportTitle}`);
        await prisma.report.update({
            where: { id: report.id },
            data: {
                department: department,
                publishDate: publishDate
            }
        });
    }

    const cases = [
        {
            title: '湖北省市场监管局依法调查处理十堰市郧阳区自然资源和规划局滥用行政权力排除、限制竞争行为',
            province: '湖北省十堰市郧阳区',
            documentOrg: '十堰市郧阳区自然资源和规划局',
            violationType: '准入障碍/设置不合理条件',
            documentName: '《十堰市郧阳区白庙山矿区建筑用白云岩矿采矿权拍卖出让公告》',
            violationClause: '《中华人民共和国反垄断法》第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”',
            violationDetail: '要求竞买人必须具备“具有独立法人资格的国有或国有控股企业，实缴注册资金2亿元以上；竞得人须承诺在郧阳区境内投资不低于30亿元打造一个产业园区”“竞买人在资质审查截止时间前提供十堰市境内任何银行的履约保函”等资格条件。',
            content: `2022年6月10日，湖北省市场监管局依法对十堰市郧阳区自然资源和规划局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2022年5月10日，当事人发布《十堰市郧阳区白庙山矿区建筑用白云岩矿采矿权拍卖出让公告》，要求竞买人必须具备“具有独立法人资格的国有或国有控股企业，实缴注册资金2亿元以上；竞得人须承诺在郧阳区境内投资不低于30亿元打造一个产业园区”“竞买人在资质审查截止时间前提供十堰市境内任何银行的履约保函”等资格条件。
湖北省市场监管局认为，当事人作为行政机关，在没有法律法规依据的情况下，对该采矿权拍卖竞买人的所有制形式、产业投入、履约保函等进行限定，排除、限制了其他同行业经营者参与当地相关市场竞争，违反了《中华人民共和国反垄断法》第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争行为，应当依法予以纠正。`,
            result: `湖北省市场监管局根据《中华人民共和国反垄断法》第五十一条“行政机关和法律、法规授权的具有管理公共事务职能的组织滥用行政权力，实施排除、限制竞争行为的，由上级机关责令改正；对直接负责的主管人员和其他直接责任人员依法给予处分。反垄断执法机构可以向有关上级机关提出依法处理的建议”的规定，向十堰市郧阳区人民政府发出行政建议书，依法提出处理建议：一是责令当事人停止滥用行政权力，限定竞买人的所有制形式、产业投入、履约保函等排除、限制竞争的违法行为，为其他经营者在相关市场提供公平竞争机会，依法保障经营者合法权益。二是要求当事人认真学习《中华人民共和国反垄断法》《国务院关于在市场体系建设中建立公平竞争审查制度的意见》等法律法规，着力推进《公平竞争审查制度实施细则》落实落地，在制定涉及市场主体经济活动的各类政策措施时，严格履行公平竞争审查程序，认真评估对市场竞争的影响，强化公平竞争政策实施。三是加强对当事人有关后续行为的监督与指导，举一反三，防止发生滥用行政权力排除、限制竞争行为。`
        },
        {
            title: '福建省市场监管局依法调查处理福州市晋安区城乡建设局滥用行政权力排除、限制竞争行为',
            province: '福建省福州市晋安区',
            documentOrg: '福州市晋安区城乡建设局',
            violationType: '准入障碍/地域限制',
            documentName: '《关于征集第三批晋安区小规模工程承发包企业候选名册名单的公告》',
            violationClause: '《中华人民共和国反垄断法》第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”',
            violationDetail: '把征集晋安区小规模工程承发包候选企业报名资格设定为“注册地在晋安区行政辖区的企业”。',
            content: `2022年5月20日，福建省市场监管局依法对福州市晋安区城乡建设局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，当事人于2020年6月16日对外发布《关于征集第三批晋安区小规模工程承发包企业候选名册名单的公告》，把征集晋安区小规模工程承发包候选企业报名资格设定为“注册地在晋安区行政辖区的企业”。按照该公告设定的条件与入选程序要求，当事人于2020年7月建立了小规模工程承发包企业候选名库，入库企业全部为注册地在晋安区行政辖区内的企业。
福建省市场监管局认为，当事人在履行综合管理全区建设行政管理职权时，没有依法平等对待不同区域的相关市场主体，设定了“注册地在晋安区行政辖区的企业”小规模工程承发包候选企业报名资格，限制了同等条件下区外市场主体进入晋安区小规模工程承发包领域的投标、建设经营，具有排除、限制小规模工程承发包领域市场竞争的效果。上述行为违反了《中华人民共和国反垄断法》第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争行为，应当依法予以纠正。`,
            result: `福建省市场监管局依据《中华人民共和国反垄断法》第五十一条“行政机关和法律、法规授权的具有管理公共事务职能的组织滥用行政权力，实施排除、限制竞争行为的，由上级机关责令改正；对直接负责的主管人员和其他直接责任人员依法给予处分。反垄断执法机构可以向有关上级机关提出依法处理的建议”的规定，向晋安区人民政府发出行政建议书，依法提出处理建议：一是责令改正相关行为，立即废止以“注册地在晋安区境内”相关文件等政策措施。二是建立完善公平竞争审查各环节流程工作制度，认真落实公平竞争审查机制。三是举一反三，对照排查。加强对当事人后续行为的监督和指导，对涉及市场主体经济活动的政策措施，要依法平等对待不同区域的相关市场主体，防止滥用行政权力排除、限制竞争行为发生。`
        },
        {
            title: '重庆市市场监管局纠正合川区农业农村委员会滥用行政权力排除、限制竞争行为',
            province: '重庆市合川区',
            documentOrg: '重庆市合川区农业农村委员会',
            violationType: '歧视性待遇/本地产品优先',
            documentName: '《重庆市合川区农业农村委员会关于印发〈2020年合川区有机肥推广示范补贴工作方案〉的通知》',
            violationClause: '《中华人民共和国反垄断法》第三十三条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，实施下列行为，妨碍商品在地区之间的自由流通：（五）妨碍商品在地区之间自由流通的其他行为”和第三十七条',
            violationDetail: '规定“商品有机肥供货企业原则上选择合川辖区内的有机肥生产企业，或在合川注册并销售合川辖区内有机肥生产企业生产的有机肥的销售企业”。',
            content: `2022年3月7日，重庆市市场监管局对合川区农业农村委涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2020年7月14日，当事人下发《重庆市合川区农业农村委员会关于印发〈2020年合川区有机肥推广示范补贴工作方案〉的通知》，文件对施用有机肥的企业给予适当补贴，在选择商品有机肥供货企业时规定“商品有机肥供货企业原则上选择合川辖区内的有机肥生产企业，或在合川注册并销售合川辖区内有机肥生产企业生产的有机肥的销售企业”。
重庆市市场监管局认为，当事人作为行政机关，制定出台仅针对辖区内或在辖区内注册并生产销售企业的有机肥示范推广补贴政策，导致外地经营者无法具备与本地经营者同等的竞争条件，妨碍了商品自由流通，排除、限制了相关市场竞争，违反了《中华人民共和国反垄断法》第三十三条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，实施下列行为，妨碍商品在地区之间的自由流通：（五）妨碍商品在地区之间自由流通的其他行为”和第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人高度重视，积极整改，消除不良影响，下发通知将原文件予以废止，组织干部职工认真学习《中华人民共和国反垄断法》等法律法规，严格落实公平竞争审查制度，全面清理废除妨碍统一市场和公平竞争的各种规定做法。`
        },
        {
            title: '重庆市市场监管局纠正秀山县农业农村委员会涉嫌滥用行政权力排除、限制竞争行为',
            province: '重庆市秀山县',
            documentOrg: '秀山县农业农村委员会',
            violationType: '指定交易/强制保险',
            documentName: '《关于做好秀山县2018年农产品收益保险实施方案的通知》',
            violationClause: '《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '规定试点保险机构：2018年生猪养殖收益保险由某2家财险秀山支公司共同承担，山羊养殖收益保险承保机构为某1家财险秀山支公司。',
            content: `2022年3月7日，重庆市市场监管局对秀山县农业农村委员会涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2018年11月12日，当事人联合秀山县财政局下发《关于做好秀山县2018年农产品收益保险实施方案的通知》，决定在全县开展生猪养殖收益保险和山羊养殖收益保险试点工作。文件中规定：“二、试点保险机构：2018年生猪养殖收益保险由某2家财险秀山支公司共同承担，山羊养殖收益保险承保机构为某1家财险秀山支公司”。
重庆市市场监管局认为，当事人作为行政机关，通过制定发布文件的方式，要求辖区内生猪养殖及山羊养殖投保农户（公司）在养殖收益保险上必须使用其指定承保机构提供养殖保险服务的行为，限制了投保农户（公司）自由选择承保机构的权利，排除了其他承保机构参与竞争，影响了当地养殖保险服务市场公平竞争，上述行为违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。`,
            result: `调查期间，当事人高度重视，积极整改，消除不良影响，下发通知将原文件予以废止，组织干部职工认真学习《中华人民共和国反垄断法》等法律法规，全面清理废除妨碍统一市场和公平竞争的各种规定做法，要求今后制定涉及市场主体的政策措施过程中，要严格落实公平竞争审查制度。`
        },
        {
            title: '新疆维吾尔自治区市场监管局依法调查处理吐鲁番市应急管理局滥用行政权力排除、限制竞争行为',
            province: '新疆维吾尔自治区吐鲁番市',
            documentOrg: '吐鲁番市应急管理局',
            violationType: '指定交易/强制服务',
            documentName: '《吐鲁番市道路运输安全生产第三方监控管理办法（试行）》、《关于消除道路运输安全隐患的通知》、《督办通知》',
            violationClause: '《中华人民共和国反垄断法》第三十二条和第三十七条',
            violationDetail: '限定第三方监控机构的注册地、注册资本等条件，指定由2家公司完成4G视频主动安全智能监控设备的安装工作。',
            content: `2022年1月19日，新疆维吾尔自治区市场监管局对吐鲁番市应急管理局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2018年3月3日，当事人以吐鲁番市安全生产委员会办公室名义印发《吐鲁番市道路运输安全生产第三方监控管理办法（试行）的通知》，限定第三方监控机构的注册地、注册资本等条件，要求向吐鲁番市道路运输管理机构进行备案。2020年10月27日，当事人以吐鲁番市安全生产委员会办公室名义印发《关于消除道路运输安全隐患的通知》，规定“将全市辖区内特别是鄯善县的车辆纳入吐鲁番市某信息技术有限公司提供的第三方监控服务中”。2021年3月31日，当事人以吐鲁番市安全生产委员会办公室名义印发《督办通知》，指定由2家公司完成4G视频主动安全智能监控设备的安装工作。
新疆维吾尔自治区市场监管局认为，当事人履行全市范围内安全生产管理工作，承担吐鲁番市安全生产委员会日常工作。当事人在没有法律法规依据的情况下，制定限定第三方监控机构备案条件排除、限制竞争内容的通知文件，强制道路运输企业使用其指定第三方监控服务企业提供的安装服务，剥夺了道路运输企业自主选择权，直接排除、限制了其他同行业经营者参与当地相关市场竞争，妨碍了市场公平竞争，违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”和第三十七条“行政机关不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争行为，应当依法予以纠正。`,
            result: `新疆维吾尔自治区市场监管局根据《中华人民共和国反垄断法》第五十一条...的规定，向吐鲁番市人民政府发出行政建议书，依法提出处理建议：一是责令当事人立即停止滥用行政权力排除、限制竞争行为，主动废止或者修改排除、限制竞争的相关规定，在官方网站公示整改结果，消除相关影响，恢复相关市场的公平竞争。二是认真落实公平竞争审查制度，要求当事人在制定涉及市场主体经济活动的各类政策措施时，严格履行公平竞争审查程序，认真评估对市场竞争产生的影响，依法维护公平竞争的市场环境。三是加强对当事人后续行为的监督与指导，防止滥用行政权力排除、限制市场竞争行为发生。`
        },
        {
            title: '云南省市场监管局依法调查处理昆明市西山区教育体育局滥用行政权力排除、限制竞争行为',
            province: '云南省昆明市西山区',
            documentOrg: '昆明市西山区教育体育局',
            violationType: '指定交易/独家经营',
            documentName: '《昆明市西山区教育体育局关于区属公办学校保安配置相关事宜的通知》',
            violationClause: '《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”',
            violationDetail: '规定“校园保安服务自2021年春季学期开始，统一由西山区保安服务公司承接”。',
            content: `2021年11月12日，云南省市场监管局对昆明市西山区教育体育局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2021年3月9日，当事人向西山区属公办中小学、幼儿园和职业学校制定印发《昆明市西山区教育体育局关于区属公办学校保安配置相关事宜的通知》，规定“校园保安服务自2021年春季学期开始，统一由西山区保安服务公司承接”。
云南省市场监管局认为，当事人制定印发文件，指定西山区保安服务公司承接自2021年春季学期开始的区属公办学校校园保安服务，直接排除、限制了其他同行业经营者参与当地相关市场竞争，违反了《中华人民共和国反垄断法》第三十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为，应当依法予以纠正。`,
            result: `云南省市场监管局根据《中华人民共和国反垄断法》第五十一条...的规定，向西山区人民政府发出行政建议书，依法提出处理建议：一是责令当事人立即改正违法行为，修改或废除《昆明市西山区教育体育局关于区属公办学校保安配置相关事宜的通知》文件。二是责令当事人向社会公开改正信息，当事人改正情况在规定时间报送云南省市场监管局。三是要求当事人举一反三，认真落实公平竞争审查制度，确保出台的政策措施符合国家法律法规的规定。`
        }
    ];

    for (const item of cases) {
        const exists = await prisma.case.findFirst({
            where: {
                title: item.title,
                reportId: report.id
            }
        });

        if (!exists) {
            await prisma.case.create({
                data: {
                    ...item,
                    reportId: report.id,
                    publishDate: publishDate
                }
            });
            console.log(`Added case: ${item.title}`);
        } else {
            console.log(`Updating existing case: ${item.title}`);
            const dataToUpdate = { ...item, publishDate };
            delete dataToUpdate.title; // title is used for finding, don't update it if we found consistent match
            await prisma.case.update({
                where: { id: exists.id },
                data: dataToUpdate
            });
        }
    }
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

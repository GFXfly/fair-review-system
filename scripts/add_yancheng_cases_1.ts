import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加盐城市公平竞争审查典型案例（一）...');

    // 1. 创建通报
    const reportData = {
        title: '盐城市公平竞争审查典型案例（一）',
        department: '盐城市市场监督管理局',
        publishDate: '2025-07-01',
        province: '江苏省'
    };

    let report = await prisma.report.findFirst({
        where: { title: reportData.title }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报, ID:', report.id);
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加4个案例
    const cases = [
        {
            title: '关于印发《XX市产后母婴照料服务机构（月子中心）备案管理规定》违法设置审批程序案',
            content: `【文件名称】关于印发《XX市产后母婴照料服务机构（月子中心）备案管理规定》的通知
【违规内容】第三条开设产后母婴照料服务机构的，应当按照本规定进行备案。法律法规另有规定的，依照有关规定执行。
第八条产后母婴照料服务机构开设者自领取营业执照30日内，要办理备案手续，相关信息包括以下材料：（略）。
【审查解析】母婴照料服务机构不属于国家发展改革委《市场准入负面清单（2022年版）》内容，且没有上位法依据。违规内容要求母婴照料机构在主管部门进行备案的做法，涉嫌变相增加了该行业准入条件。
【处理结果】该文件在履行征求意见程序时被分送至审查人员所在处室，审查人员书面指出了上述问题，目前该文件已终止起草。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '关于印发《XX市产后母婴照料服务机构（月子中心）备案管理规定》的通知',
            documentOrg: '相关起草单位',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（一）对市场准入负面清单以外的行业、领域、业务等违法设置审批程序。`,
            violationDetail: '要求母婴照料机构在主管部门进行备案，涉嫌变相增加该行业准入条件。',
        },
        {
            title: '《关于印发进一步规范和加强XX城镇生活污水处理设施一体化建设运营管理的通知》违法授予特许经营权案',
            content: `【文件名称】《关于印发进一步规范和加强XX城镇生活污水处理设施一体化建设运营管理的通知》
【违规内容】2023年9月底前，与城投集团（净水公司）签订城镇生活污水处理一体化设施建设运营管理协议。
【审查解析】城镇生活污水处理作为公用事业行业之一，可依法实施政府特许经营。但在具体实施特许经营时，应当通过公开招标或竞争性谈判确定中标单位。违规内容明确区域投集团负责城镇污水处理项目，直接将减排运营予城投集团特许经营权。
【处理结果】审查人员在监测中发现了该份违规文件，并及时向起草单位发送《整改提醒函》。目前该文件已经废止。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于印发进一步规范和加强XX城镇生活污水处理设施一体化建设运营管理的通知》',
            documentOrg: '相关起草单位',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（二）违法设置或者授予特许经营权。`,
            violationDetail: '未通过公开招标或竞争性谈判，直接指定城投集团负责城镇污水处理项目。',
        },
        {
            title: '《关于全面推进面向中小学生校外培训机构分类管理工作的通知》限定交易案',
            content: `【文件名称】《关于全面推进面向中小学生校外培训机构分类管理工作的通知》
【违规内容】建立健全校外培训机构培训费收费监管制度。明确要求审核心准入的校外培训机构必须按照规定开设资金监管账户（预收费资金监管银行名单详见附件）
【审查解析】资金监管银行应由校外培训机构自由选择，如起草单位的本意是整理具有竞业托管服务银行名单供各校外培训机构选择，对应表述应为“我地具备资金托管服务银行现有XX银行、XX银行...，各校外培训机构可根据实际情况自由选择。”因此违规内容涉嫌强制校外培训机构使用指定几家银行提供的服务。
【处理结果】审查人员在监测中发现了该份违规文件，并及时向起草单位发送《整改提醒函》。目前该文件已经废止。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于全面推进面向中小学生校外培训机构分类管理工作的通知》',
            documentOrg: '相关起草单位',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务。`,
            violationDetail: '强制校外培训机构必须在指定名单内的银行开设资金监管账户，限定交易。',
        },
        {
            title: '某镇零星小型工程审计服务招标公告设置不合理准入条件案',
            content: `【文件名称】某镇零星小型工程(100万元以下)审计服务(不包含开标)招标公告
【违规内容】投标人2020年1月1日(以合同签订时间为准)以来承担过单项工程审计金额5000万元及以上的工程审核(或复核)服务。
【审查解析】违规内容要求供应商具备单项5000万元以上工程的审计经验，而项目的合计金额仅为100万元以下，明显超出了实际需要，构成设置不合理的准入条件的违规情形。
【处理结果】审查人员在监测中发现了该份违规文件，并及时向起草单位发送《整改提醒函》。因该招标项目在发现时已经实施，起草单位出具了《情况说明》，并承诺加强内部审查把关，确保文件合规出台。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '某镇零星小型工程(100万元以下)审计服务招标公告',
            documentOrg: '某镇人民政府',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（四）设置不合理或者变相歧视性的准入、退出条件。`,
            violationDetail: '对于仅100万元以下的项目，要求具备单项5000万元以上工程的审计经验，设置不合理准入条件。',
        },
    ];

    let count = 0;
    for (const caseData of cases) {
        await prisma.case.create({
            data: {
                ...caseData,
                province: '江苏省',
                publishDate: reportData.publishDate,
                legalScope: '公平竞争审查',
                reportId: report.id
            }
        });
        console.log(`✅ 已添加案例 ${count + 1}:`, caseData.title);
        count++;
    }

    console.log(`\n处理完成，共添加 ${count} 个案例到 Report ID ${report.id}。`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

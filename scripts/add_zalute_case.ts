import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加扎鲁特旗公平竞争审查典型案例...');

    // 1. 创建或获取 Report（通报）
    const reportData = {
        title: '扎鲁特旗市场监督管理局发布1起违反公平竞争审查典型案例',
        department: '扎鲁特旗市场监督管理局',
        publishDate: '2025-10-14',
        province: '内蒙古自治区'
    };

    let report = await prisma.report.findFirst({
        where: { title: reportData.title }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报:', reportData.title, '(ID:', report.id, ')');
        // 清理该Report下的旧案例
        console.log('清理该通报下的旧案例...');
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加具体案例
    const caseData = {
        title: '扎鲁特旗某局招标公告设置不合理条件排斥外地经营者',
        content: `【基本事实】

2025年8月，扎鲁特旗市场监督管理局接到通辽市市场监管局转发过来的关于扎鲁特旗某局在公众号上发布的招标公告的公平竞争审查评估报告。报告显示，该招标公告中报名条件中要求"需具有近年受托在内蒙古自治区进行过物资、服务等政府招标采购代理任务的"；该公告要求将报价文件密封后现场递交至指定地点，而报价文件的递交等同于报名，公告中未提供其他报名渠道。

【案例分析】

一、《中华人民共和国政府采购法实施条例》明确提及"第二十条 采购人或者采购代理机构有下列情形之一的，属于以不合理的条件对供应商实行差别待遇或者歧视待遇:(四)以特定行政区域或者特定行业的业绩、奖项作为加分条件或者中标、成交条件。"该要求以特定地区业绩作为评审标准，排除了其他承接过非内蒙古自治区类似业绩的招标代理机构参与竞争，具有妨碍公平竞争的效果。涉嫌违反《公平竞争审查条例》第九条，起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容:(三)排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标;及《公平竞争审查条例实施办法》第十五条，起草涉及经营者经济活动的政策措施，不得含有下列排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标的内容:(三)将经营者取得业绩和奖项荣誉的区域、缴纳税收社保的区域、投标(响应)产品的产地、注册地址、与本地经营者组成联合体等作为投标(响应)条件、加分条件、中标(成交、入围)条件或者评标条款。

二、该公告要求将报价文件密封后现场递交至指定地点，而报价文件的递交等同于报名，此举为潜在供应商带来了额外的成本，具有妨碍公平竞争的效果。涉嫌违反《公平竞争审查条例》第九条，起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容:(三)排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标；及《公平竞争审查条例实施办法》第十五条，起草涉及经营者经济活动的政策措施,不得含有下列排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标的内容:(六)设置不合理的公示时间、响应时间、要求现场报名或者现场购买采购文件、招标文件等，影响外地经营者参加本地政府采购、招标投标。

【整改情况】

扎鲁特旗市场监督管理局自收到此评估报告后，于当日立即向此招标公告起草单位下达《提醒敦促函》，要求该单位尽快研究相关条款，并对涉嫌违反标准的条款进行修改清理。该单位收到《提醒敦促函》后，当日即对招标公告相关条款进行修改，重新在公众号上进行公示，并向市场监管局报送《整改报告》。此次事件从接到线索到完成整改全程仅用1个工作日，通过"接报—核查—处置—整改"的全链条快速响应，成功避免了不公平竞争行为对市场主体参与积极性的挫伤，有效维护了招投标领域的公平竞争秩序。`,

        province: '内蒙古自治区',
        publishDate: '2025-10-14',
        violationType: '排斥限制外地经营者参与招标投标',
        result: '已整改',

        // 文件信息
        documentName: '招标公告',
        documentOrg: '扎鲁特旗某局',

        // 违反条款（按照标准格式，每个法规单独一段）
        violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（三）排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标。

《公平竞争审查条例实施办法》
第十五条
（三）将经营者取得业绩和奖项荣誉的区域、缴纳税收社保的区域、投标（响应）产品的产地、注册地址、与本地经营者组成联合体等作为投标（响应）条件、加分条件、中标（成交、入围）条件或者评标条款。

《公平竞争审查条例实施办法》
第十五条
（六）设置不合理的公示时间、响应时间、要求现场报名或者现场购买采购文件、招标文件等，影响外地经营者参加本地政府采购、招标投标。

《中华人民共和国政府采购法实施条例》
第二十条 采购人或者采购代理机构有下列情形之一的，属于以不合理的条件对供应商实行差别待遇或者歧视待遇：
（四）以特定行政区域或者特定行业的业绩、奖项作为加分条件或者中标、成交条件。`,
        violationDetail: `1. 设置地域限制条件：招标公告要求"需具有近年受托在内蒙古自治区进行过物资、服务等政府招标采购代理任务的"，以特定地区业绩作为评审标准，排除了其他承接过非内蒙古自治区类似业绩的招标代理机构参与竞争。

2. 要求现场递交文件：该公告要求将报价文件密封后现场递交至指定地点，而报价文件的递交等同于报名，公告中未提供其他报名渠道，此举为外地潜在供应商带来了额外的时间和经济成本。`,

        legalScope: '政府采购、招标投标',

        // 关联到 Report
        reportId: report.id
    };

    const createdCase = await prisma.case.create({
        data: caseData
    });

    console.log('✅ 案例添加成功:', createdCase.title);
    console.log('   关联到通报 ID:', report.id);
    console.log('   省份:', createdCase.province);
    console.log('   违规类型:', createdCase.violationType);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加江西省2025年12月公平竞争审查典型案例...');

    // 1. 创建 Report（通报）
    const reportData = {
        title: '江西省市场监管局通报公平竞争审查典型案例',
        department: '江西省市场监督管理局',
        publishDate: '2025-12-02',
        province: '江西省'
    };

    let report = await prisma.report.findFirst({
        where: {
            title: reportData.title,
            publishDate: reportData.publishDate
        }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报:', reportData.title, '(ID:', report.id, ')');
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加10个具体案例
    const cases = [
        {
            title: '某市财政局在政策措施中规定以在本地设立分支机构、注册等作为享受奖励的必要条件',
            content: `2024年9月，某市财政局印发《某市推进服务业高质量发展若干措施重点推进会计服务实施细则》，规定"1．支持范围：2023－2024年度被评为全国百强会计师事务所的，在某市设立分支机构，且2024－2025年取得某市分所营业执照及江西省财政厅批复的执业证书"，以在本地设立分支机构、注册等为条件对全国排名前100的会计师事务所，实施财政奖励。

目前，该市财政局已废止相关文件。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《某市推进服务业高质量发展若干措施重点推进会计服务实施细则》',
            documentOrg: '某市财政局',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '以在本地设立分支机构、注册等为条件对全国排名前100的会计师事务所实施财政奖励，给予特定经营者选择性、差异化的财政奖励。',
        },
        {
            title: '某区人民政府办公室在政策措施中规定获得奖补企业六年内迁出的须全额退还奖补',
            content: `2023年4月，某区人民政府办公室印发《某市某区支持专精特新中小企业高质量发展若干措施（试行）》，规定"在相关扶持政策正常执行的情况下，企业注册地、工商、税务关系在扶持政策享受期满后6年内不得迁离某区。否则，企业有义务退回之前所有所得奖励和补助"，对企业自主迁移设置障碍。

目前，该文件已失效。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《某市某区支持专精特新中小企业高质量发展若干措施（试行）》',
            documentOrg: '某区人民政府办公室',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（一）限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出。`,
            violationDetail: '规定企业在扶持政策享受期满后6年内不得迁离本区，否则须退回所有奖励和补助，对企业自主迁移设置障碍。',
        },
        {
            title: '某区人民政府在政策措施中规定将外地上市公司迁至本地并将注册地迁至本地作为享受奖励的必要条件',
            content: `2023年5月，某区人民政府印发《关于优化调整加快推进企业上市"映山红行动"若干政策措施的通知》，规定"鼓励外地上市公司迁入我区。对注册地迁入我区的上市公司（含异地'借壳'上市后迁入），可采取'一事一议'的方式加大奖励力度"，以外地经营者将注册地迁移至本地等为条件，实施财政奖励。

目前，该区人民政府已废止相关文件。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《关于优化调整加快推进企业上市"映山红行动"若干政策措施的通知》',
            documentOrg: '某区人民政府',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '以外地经营者将注册地迁移至本地等为条件实施财政奖励，给予特定经营者选择性、差异化的财政奖励。',
        },
        {
            title: '某县人民政府在政策措施中规定采用本县装配式生产加工企业部品部件给予补贴',
            content: `2022年5月，某县人民政府印发《某县人民政府关于推进装配式建筑发展的实施意见（修订）》，规定"落实资金补贴。在全县范围内，对采用装配式现代化施工，2022年－2023年新开工的装配率达到40％及以上（2022年以前已明确约定和已办理批准的项目，按已约定和已办理批准的装配率要求为准，装配率达到30％及以上）、2024年－2025年新开工的装配率达到45％及以上的房地产开发项目且采用本县装配式生产加工企业部品部件的，给予建设单位50元／平方米的资金补贴，单个项目最高补贴不超过200万元；给予生产加工企业10元／平方米的资金补贴"，采用本县装配式生产加工企业部品部件的，给予建设单位50元／平方米的资金补贴，限定使用特定经营者提供的服务。

目前，该县人民政府已废止相关文件。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《某县人民政府关于推进装配式建筑发展的实施意见（修订）》',
            documentOrg: '某县人民政府',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务（以下统称商品）。`,
            violationDetail: '规定采用本县装配式生产加工企业部品部件的给予建设单位补贴，限定使用特定经营者提供的服务。',
        },
        {
            title: '某县人民政府在政策措施中规定将注册地迁至本地作为享受补贴和优惠政策等的必要条件',
            content: `2022年8月，某县人民政府印发《关于支持现代服务业高质量发展若干政策措施意见的通知》，规定"支持新上综合物流园区、物流企业总部、区域总部、区域分拨中心落户我县，按在某县实际投入项目资金超过1亿元、3亿元、5亿元，分别给予奖励50万元、100万元、200万元"，将经营者落户本地作为享受补贴和优惠政策等的必要条件。

目前，该县人民政府已修订相关文件。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《关于支持现代服务业高质量发展若干政策措施意见的通知》',
            documentOrg: '某县人民政府',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '将经营者落户本地作为享受补贴和优惠政策等的必要条件，给予特定经营者选择性、差异化的财政奖励。',
        },
        {
            title: '某县人民政府办公室在政策措施中规定从事光伏建设须在我县成立具有独立法人资格的项目开发公司',
            content: `2023年5月，某县人民政府办公室印发《关于加强某县户用屋顶光伏建设管理的实施意见（试行）》，规定"准入条件。具备雄厚的可再生能源投资开发实力，且信用良好的央企、地方国企、上市公司及优秀民营企业等开发企业，并具备承装（修、试）电力设施许可证及相关证照等国家规定的相关资质，须在我县成立具有独立法人资格的项目开发公司，依法依规在本县缴纳税费"，要求从事光伏建设须在我县成立具有独立法人资格的项目开发公司，设置了不合理的准入条件。

目前，该县人民政府已废止相关文件。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于加强某县户用屋顶光伏建设管理的实施意见（试行）》',
            documentOrg: '某县人民政府办公室',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（四）设置不合理或者歧视性的准入、退出条件。`,
            violationDetail: '要求从事光伏建设须在本县成立具有独立法人资格的项目开发公司，设置了不合理的准入条件。',
        },
        {
            title: '某区人民政府办公室在政策措施中规定对特定经营者给予要素获取方面的优惠',
            content: `2023年5月，某区人民政府办公室印发《某区提升农业产业化发展水平三年行动方案（2023—2025年）》，规定"强化用地支持。落实农村产业融合发展用地优惠政策，对省级农业产业化龙头企业和具有发展潜力的市、县级农业产业化龙头企业建设用地，优先安排、优先审批，按照规定享受土地规费相关优惠政策。对农业龙头企业、休闲农业等生产经营主体实施农业产业项目，有农业建设用地需求，主动协助生产经营主体解决用地需求"，构成了给予特定经营者要素获取方面的优惠。

目前，该区人民政府已废止相关文件。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《某区提升农业产业化发展水平三年行动方案（2023—2025年）》',
            documentOrg: '某区人民政府办公室',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（三）给予特定经营者要素获取、行政事业性收费、政府性基金、社会保险费等方面的优惠。`,
            violationDetail: '对省级、市县级农业产业化龙头企业建设用地优先安排、优先审批，给予特定经营者要素获取方面的优惠。',
        },
        {
            title: '某市科学技术局在政策措施中规定对符合同一条件的市内外企业实施差异化的补助',
            content: `2024年11月，某市科学技术局印发《新一轮科技新政配套实施细则和工作方案》，规定"经审核符合条件的，市内注册的机构（个人）按促成实际技术交易额的5％进行补助，市外注册的机构（个人）按促成实际技术交易额的1％进行补助"，对符合同一条件的市内外企业实施差异化的补助。

目前，该市科学技术局已废止相关文件。`,
            violationType: '影响生产经营成本',
            result: '已整改',
            documentName: '《新一轮科技新政配套实施细则和工作方案》',
            documentOrg: '某市科学技术局',
            violationClause: `《公平竞争审查条例》
第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '市内注册机构按5%补助，市外注册机构按1%补助，对符合同一条件的市内外企业实施差异化补助。',
        },
        {
            title: '某区人民政府办公室在政策措施中规定直接指定特定经营者负责施工',
            content: `2022年9月，某区人民政府办公室印发《某区中心城区开放式居民区围合管理工作实施方案》，规定"为便于工作高效推进和支持国企发展，投资金额在400万元以下限额内的，可直接发包某公司负责施工"，排斥或限制潜在经营主体提供商品和服务。

目前，该区人民政府已废止相关文件。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《某区中心城区开放式居民区围合管理工作实施方案》',
            documentOrg: '某区人民政府办公室',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务（以下统称商品）。`,
            violationDetail: '规定投资金额在400万元以下的可直接发包某公司负责施工，排斥或限制其他潜在经营主体提供服务。',
        },
        {
            title: '某县人民政府办公室在政策措施中规定凡在我县落地的项目必须注册为独立法人企业',
            content: `2021年6月，某县人民政府办公室印发《某县"四上"企业培育及项目入规入库工作方案》，规定"完善注册登记工作。严把招商引资项目源头关，除特殊情况外，凡在我县落地的项目必须注册为独立法人企业，坚决杜绝在我县开发经营的企业再设立分公司、分厂等产业单位"，变相强制外地经营者在本地投资或者设立分支机构。

目前，该县人民政府已废止相关文件。`,
            violationType: '限制商品要素自由流动',
            result: '已整改',
            documentName: '《某县"四上"企业培育及项目入规入库工作方案》',
            documentOrg: '某县人民政府办公室',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构。`,
            violationDetail: '规定在本县落地的项目必须注册为独立法人企业，杜绝设立分公司、分厂等，变相强制外地经营者在本地设立分支机构。',
        },
    ];

    let count = 0;
    for (const caseData of cases) {
        await prisma.case.create({
            data: {
                ...caseData,
                province: '江西省',
                publishDate: '2025-12-02',
                legalScope: '公平竞争审查',
                reportId: report.id
            }
        });
        console.log(`✅ 已添加案例 ${count + 1}:`, caseData.title);
        count++;
    }

    console.log(`\n处理完成，共添加 ${count} 个案例到 Report ID ${report.id}。`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

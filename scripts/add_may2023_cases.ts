
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    const departmentStr = '国家市场监督管理总局';

    // 1. 浙江新昌案例
    const case1Data = {
        title: '浙江省市场监管局纠正绍兴市新昌县人民政府滥用行政权力排除、限制竞争行为',
        publishDate: '2023-05-09',
        province: '浙江省',
        department: departmentStr,
        content: `2022年10月10日，浙江省市场监管局依法对新昌县人民政府涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2020年5月7日，当事人印发《学校食堂大宗食品综合配送招标及招生报名工作相关问题协调会纪要》（〔2020〕44号），规定新昌县学校食堂大宗食品综合配送公开招标仍按原配送区域分 I、II两类进行。其中，I 类招标：确定新昌县域范围内设有食品配送中心的本县准入配送企业一家。本轮公开招标准入企业的配送期限仍为三学年（2020-2022学年）。新昌县教育体育局按照上述会议纪要要求，委托代理机构于2020年6月2日发布招标文件，规定新昌县学校食堂大宗食品综合配送 I 类准入企业投标人资格为在新昌县域内设有配送中心且具有配送经验和配送能力的本县企业。经招投标，中标企业为新昌县本地某配送服务有限公司。
浙江省市场监管局认为，当事人通过会议协调方式明确新昌县学校食堂大宗食品综合配送 I 类准入企业为新昌县本地企业的行为，排斥、限制了具有相应资质的外地企业参加该县学校食堂大宗食品综合配送企业招投标，违反了《中华人民共和国反垄断法》第四十二条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，以设定歧视性资质要求、评审标准或者不依法发布信息等方式，排斥或者限制经营者参加招标投标以及其他经营活动”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人主动积极整改，召开协调会议决定不再执行原有关规定，终止原有合同，重新发布招标公告，保证公平竞争，向浙江省市场监管局提交了整改报告，完善公平竞争审查机制。`,
        violationType: '排斥外地企业/歧视性资质要求',
        violationClause: '《中华人民共和国反垄断法》第四十二条（不得排斥或者限制经营者参加招标投标以及其他经营活动）',
        documentName: '《学校食堂大宗食品综合配送招标及招生报名工作相关问题协调会纪要》',
        documentOrg: '浙江省绍兴市新昌县人民政府',
        provinceDetail: '浙江省绍兴市新昌县',
        violationDetail: '规定投标人资格为在新昌县域内设有配送中心的本县企业，排斥外地企业。',
        result: '不再执行规定，终止合同，重新招标。'
    };

    // 2. 黑龙江哈尔滨案例
    const case2Data = {
        title: '黑龙江省市场监管局纠正哈尔滨市城市管理局滥用行政权力排除、限制竞争行为',
        publishDate: '2023-05-09',
        province: '黑龙江省',
        department: departmentStr,
        content: `2022年9月19日，黑龙江省市场监管局依法对哈尔滨市城市管理局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2021年4月8日，当事人以哈尔滨市城市管理委员会名义印发《关于印发哈尔滨市共享单车停放秩序规范管理实施方案的通知》中明确：“现将〈哈尔滨市共享单车停放秩序规范管理实施方案〉印发给你们，作为组织共享单车招标投放和停放秩序管理等工作的依据，......”。2021年4月16日，当事人委托第三方通过黑龙江省公共资源交易网发布《哈尔滨市共享单车投放份额招标（一标段、二标段、三标段）招标公告》，项目设立三个标段，其中自行车两个标段、助力车一个标段，要求兼投不兼中。当事人与三家中标单位分别签订了《共享单车规范停放管理协议》。
黑龙江省市场监管局认为，当事人没有法律、法规依据，通过招标方式确定中标企业，并与中标企业签订协议，约定由中标企业提供哈尔滨市主城区共享单车服务，排除、限制了其他具有相应资质和服务能力的企业参与该区域共享单车市场竞争，剥夺了消费者的自主选择权。当事人的上述行为违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品。”和第四十五条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争的行为。
调查期间，当事人积极整改，消除不良影响，废止相关文件，并在政府网站进行公告，相关协议自动解除。当事人向黑龙江省市场监管局提交了整改报告，表示将严格执行公平竞争审查制度，凡涉及市场主体经济活动的政策措施必须经过公平竞争审查，防止出现排除、限制竞争情况。`,
        violationType: '指定交易/限制准入',
        violationClause: '《中华人民共和国反垄断法》第三十九条（指定交易）、第四十五条（制定含有排除限制竞争规定）',
        documentName: '《关于印发哈尔滨市共享单车停放秩序规范管理实施方案的通知》及招标公告',
        documentOrg: '黑龙江省哈尔滨市城市管理局',
        provinceDetail: '黑龙江省哈尔滨市',
        violationDetail: '通过招标方式确定3家企业独家经营，限制其他企业进入。',
        result: '废止文件，解除协议。'
    };

    // 3. 浙江象山案例
    const case3Data = {
        title: '浙江省市场监管局纠正宁波市象山县住房和城乡建设局滥用行政权力排除、限制竞争行为',
        publishDate: '2023-05-09',
        province: '浙江省',
        department: departmentStr,
        content: `2022年10月10日，浙江省市场监管局依法对象山县住房和城乡建设局涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2022年3月29日，当事人印发《象山县房屋安全鉴定市场管理细则》（象建房〔2022〕1号），规定“鉴定机构在本县行政区域范围内开展房屋安全鉴定业务的，在取得市住建局备案证明后应向县住建局进行登记”“县住建局每年对登记满一年的鉴定机构进行考核。登记考核合格的鉴定机构录入对社会公布的象山县鉴定机构推荐名录。有关单位和个人可从推荐名录中自主择优选定鉴定机构”“鉴定机构未经登记不得擅自开展鉴定服务”“年度考核分低于60分的视为考核不合格，予以撤销登记”。
浙江省市场监管局认为，当事人印发文件要求在该县开展房屋安全鉴定业务的房屋安全鉴定机构向该局登记，规定未经登记不得开展鉴定服务，年度考核分低于60分的视为考核不合格，予以撤销登记，对登记考核合格的鉴定机构建立推荐名录的行为，排除、限制了该县房屋安全鉴定服务市场公平竞争，违反了《中华人民共和国反垄断法》第四十五条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争的行为。
调查期间，当事人主动积极整改，废止原文件，在政府网站进行公布，向浙江省市场监管局提交了整改报告，全面开展自查工作，完善公平竞争审查机制。`,
        violationType: '设置不合理准入条件/建立推荐名录',
        violationClause: '《中华人民共和国反垄断法》第四十五条（不得滥用行政权力，制定含有排除、限制竞争内容的规定）',
        documentName: '《象山县房屋安全鉴定市场管理细则》',
        documentOrg: '浙江省宁波市象山县住房和城乡建设局',
        provinceDetail: '浙江省宁波市象山县',
        violationDetail: '建立推荐名录，规定未经登记不得开展服务，设定不合理考核退出机制。',
        result: '废止原文件，全面自查。'
    };

    // 4. 重庆花溪案例
    const case4Data = {
        title: '重庆市市场监管局纠正花溪街道办事处滥用行政权力排除、限制竞争行为',
        publishDate: '2023-05-04',
        province: '重庆市',
        department: departmentStr,
        content: `2022年11月8日，重庆市市场监管局对重庆市巴南区人民政府花溪街道办事处涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2022年3月17日，重庆市巴南区某小区第三届业委会向全体主发布《关于某小区召开2022年第一次业主大会会议的公告（意见征求稿）》，拟召开全体业主大会，更换小区物业。2022年3月31日，当事人向重庆市巴南区某小区第三届业委会发出《关于对<召开2022年第一次业主大会会议的公告（意见征求稿）>的指导意见函》，文件要求“针对信息化技术征求业主意见，应当理解为采用由市住房和城乡建设委员会开发建设的业主决策信息系统进行电子投票”。
重庆市市场监督管理局认为，当事人作为行政机关，出台政策文件时限定单位使用其指定的经营者提供的商品，排除、限制了当地物业行业电子投票系统领域的竞争，上述行为违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”的规定，构成滥用行政权力排除、限制竞争行为。
调查期间，当事人高度重视，积极整改，消除不良影响，撤销滥用行政权力排除、限制竞争行为的原文件，组织干部职工认真学习《中华人民共和国反垄断法》等法律法规，全面清理废除妨碍统一市场和公平竞争的各种规定做法，要求今后制定涉及市场主体的政策措施过程中，要严格落实公平竞争审查制度。`,
        violationType: '指定交易',
        violationClause: '《中华人民共和国反垄断法》第三十九条（不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品）',
        documentName: '《指导意见函》',
        documentOrg: '重庆市巴南区人民政府花溪街道办事处',
        provinceDetail: '重庆市巴南区',
        violationDetail: '限定业主大会必须使用指定的业主决策信息系统进行电子投票。',
        result: '撤销原文件。'
    };

    // 5. 湖北荆门案例
    const case5Data = {
        title: '湖北省市场监管局纠正荆门市城市管理执法委员会滥用行政权力排除、限制竞争行为',
        publishDate: '2023-05-04',
        province: '湖北省',
        department: departmentStr,
        content: `2022年6月13日，湖北省市场监管局依法对荆门市城市管理执法委员会涉嫌滥用行政权力排除、限制竞争行为立案调查。
经查，2018年1月22日，当事人在《关于研究中心城区户外广告规范管理有关工作的纪要》中明确：“严格户外广告许可运营监管流程，户外广告设置要严格按照某公司申请......各区和市城管局定期向某公司通报监管情况—某公司定期向各区和市城管局通报运营情况”。2022年3月14日，当事人发布《荆门市中心城区户外广告、门店招牌专项整治工作方案》明确“一个机制运营”，即由“某公司采取拍卖、租赁或自主经营等多种形式，......”并联合某公司开展户外广告整治。
湖北省市场监管局认为，当事人在没有法律法规和政策依据的情况下，指定某公司统一承接办理中心城区户外广告设置的申报手续，要求各广告经营者使用特定经营者提供的服务的行为，排除限制了其他具有合格资质和服务能力的广告经营企业参与相关市场公平竞争的机会。该行为违反了《中华人民共和国反垄断法》第三十九条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，限定或者变相限定单位或者个人经营、购买、使用其指定的经营者提供的商品”和第四十五条“行政机关和法律、法规授权的具有管理公共事务职能的组织不得滥用行政权力，制定含有排除、限制竞争内容的规定”的规定，构成滥用行政权力排除、限制竞争的行为。
调查期间，当事人积极整改，主动消除相关影响，废止有关文件，在政府网站进行公布，对符合《荆门市中心城区户外广告专项规划》需申请设置大型户外广告的业主，明确均可自行申报，恢复了相关市场竞争，向湖北省市场监管局提交了整改报告，并进一步完善公平竞争审查机制。`,
        violationType: '指定交易/滥用行政权力',
        violationClause: '《中华人民共和国反垄断法》第三十九条（指定交易）、第四十五条（制定含有排除限制竞争规定）',
        documentName: '《纪要》及《专项整治工作方案》',
        documentOrg: '湖北省荆门市城市管理执法委员会',
        provinceDetail: '湖北省荆门市',
        violationDetail: '指定某公司统一承接及管理中心城区户外广告设置申报及运营。',
        result: '废止文件，恢复自行申报。'
    };


    const cases = [case1Data, case2Data, case3Data, case4Data, case5Data];

    for (const c of cases) {
        // Find or create report
        let report = await prisma.report.findFirst({
            where: { title: c.title }
        });

        if (!report) {
            report = await prisma.report.create({
                data: {
                    title: c.title,
                    department: c.department,
                    publishDate: c.publishDate,
                    province: c.province,
                }
            });
            console.log(`Created Report: ${report.title}`);
        } else {
            console.log(`Report exists: ${report.title}`);
        }

        // Check if case exists
        const existingCase = await prisma.case.findFirst({
            where: {
                title: c.title,
                reportId: report.id
            }
        });

        if (!existingCase) {
            await prisma.case.create({
                data: {
                    title: c.title,
                    content: c.content,
                    violationType: c.violationType,
                    violationClause: c.violationClause,
                    documentName: c.documentName,
                    documentOrg: c.documentOrg,
                    province: c.provinceDetail,
                    violationDetail: c.violationDetail,
                    result: c.result,
                    publishDate: c.publishDate,
                    reportId: report.id
                }
            });
            console.log(`Created Case: ${c.title}`);
        } else {
            console.log(`Case exists: ${c.title}`);
        }
    }
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    console.log('开始添加南京市2024年度公平竞争审查典型案例...');

    // 1. 创建通报
    const reportData = {
        title: '2024年度公平竞争审查抽查整改典型案例发布',
        department: '南京市市场监督管理局',
        publishDate: '2025-03-20',
        province: '江苏省'
    };

    let report = await prisma.report.findFirst({
        where: { title: reportData.title }
    });

    if (!report) {
        console.log('创建新通报:', reportData.title);
        report = await prisma.report.create({
            data: reportData
        });
    } else {
        console.log('使用已有通报, ID:', report.id);
        await prisma.case.deleteMany({
            where: { reportId: report.id }
        });
    }

    // 2. 添加4个案例
    const cases = [
        {
            title: '某区农业农村局违法设置不合理的准入条件案',
            content: `【文件名称】《关于申报2024年某区市级水稻植保专业化统防统治组织服务组织的通知》
【违规内容】含有“申报的服务组织要求在工商部门登记注册，且在我区开展一年以上植保专业化服务，日作业能力必须超过1000亩，水稻统防统治面积2000亩以上”等内容，要求服务组织必须要有本地落地实施一年以上经验才能参与申报，作为服务组织享受相关政策补贴。
【审查解析】违反《公平竞争审查条例》第八条“起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：（四）设置不合理或者变相歧视性的准入、退出条件”的规定。
【处理结果】目前该文件已废止。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于申报2024年某区市级水稻植保专业化统防统治组织服务组织的通知》',
            documentOrg: '某区农业农村局',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（四）设置不合理或者变相歧视性的准入、退出条件。`,
            violationDetail: '要求服务组织必须要有本地落地实施一年以上经验才能参与申报，设置不合理准入条件。',
        },
        {
            title: '某街道办事处限制外地经营者申报参与本地经营活动案',
            content: `【文件名称】《关于某街道小微爱心微创投项目申报的通知》
【违规内容】规定：“申报项目的社会组织应当具备下列资格条件：（一）依法在本区登记注册的社会组织可申报，且具有独立承担民事责任的能力”等内容。
【审查解析】违反《公平竞争审查条例》第八条“起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：（四）设置不合理或者变相歧视性的准入、退出条件”的规定。
【处理结果】目前文件已修改。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《关于某街道小微爱心微创投项目申报的通知》',
            documentOrg: '某街道办事处',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（四）设置不合理或者变相歧视性的准入、退出条件。`,
            violationDetail: '限定仅依法在本区登记注册的社会组织可申报，限制外地经营者。',
        },
        {
            title: '某区生态环境局限定经营、购买或者使用特定经营者提供的商品或者服务案',
            content: `【文件名称】《某区“十四五”时期“无废城市”建设实施方案》
【违规内容】“区内拆除垃圾由某公司利用处置”等内容。
【审查解析】违反《公平竞争审查条例》第八条“起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：（三）限定经营、购买或者使用特定经营者提供的商品或者服务”的规定。
【处理结果】目前文件已整改。`,
            violationType: '限制市场准入和退出',
            result: '已整改',
            documentName: '《某区“十四五”时期“无废城市”建设实施方案》',
            documentOrg: '某区生态环境局',
            violationClause: `《公平竞争审查条例》
第八条 起草单位起草的政策措施，不得含有下列限制或者变相限制市场准入和退出的内容：
（三）限定经营、购买或者使用特定经营者提供的商品或者服务。`,
            violationDetail: '指定区内拆除垃圾由某公司利用处置，限定交易。',
        },
        {
            title: '某区商务局将上市公司注册地、纳税地迁移至本地作为奖补条件案',
            content: `【文件名称】《某区关于强化投资促进推动制造业高质量发展政策措施（试行）》
【违规内容】“鼓励企业资本市场融资。境内上市公司注册地在某区或境外上市公司生产基地、纳税地迁至某区，且10年内不迁出的给予最高1000万元奖励，对新上市挂牌企业给予最高500万元奖励”等内容。
【审查解析】违反了《公平竞争审查条例》第九条“...（一）限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出；（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构”；第十条“...（二）给予特定经营者选择性、差异化的财政奖励或者补贴”的规定。
【处理结果】目前该文件已经暂缓执行，正在进行修订。`,
            violationType: '限制商品要素自由流动',
            result: '整改中',
            documentName: '《某区关于强化投资促进推动制造业高质量发展政策措施（试行）》',
            documentOrg: '某区商务局',
            violationClause: `《公平竞争审查条例》
第九条 起草单位起草的政策措施，不得含有下列限制商品、要素自由流动的内容：
（一）限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出；
（二）排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构。

第十条 起草单位起草的政策措施，没有法律、行政法规依据或者未经国务院批准，不得含有下列影响生产经营成本的内容：
（二）给予特定经营者选择性、差异化的财政奖励或者补贴。`,
            violationDetail: '将上市公司注册地、纳税地迁移至本地并承诺不迁出作为给予高额奖补的条件，限制要素流动并给予特定企业差异化奖励。',
        },
    ];

    let count = 0;
    for (const caseData of cases) {
        await prisma.case.create({
            data: {
                ...caseData,
                province: '江苏省',
                publishDate: reportData.publishDate,
                legalScope: '公平竞争审查',
                reportId: report.id
            }
        });
        console.log(`✅ 已添加案例 ${count + 1}:`, caseData.title);
        count++;
    }

    console.log(`\n处理完成，共添加 ${count} 个案例到 Report ID ${report.id}。`);
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });
